<html>
  <head>
    <meta charset="utf-8">
  </head>
  <style>
    *{
      margin:1px;
    }
    textarea{
      height: 40vh;
      width: calc(99vw - 10px);
      margin: 5px;
    }
  </style>
  <body>
    <h1 id="title">Edit the Text</h1>
    <div>
      <span>
        目标路径：<input type="text" id="path" style="width:90vw;">
      </span>
    </div>
    <div>
      <textarea id="input"></textarea>
      <p>当前状态
        <button onclick="_edit();">编辑一次</button>
        <button onclick="_reload();">向上刷新</button>
      </p>
      <textarea id="look"></textarea>
    </div>
<script>
  "use strict";
  function EditText(urlname,ctnt,Func){
  	fetch(`https://tikolu.net/edit/${encodeURIComponent(urlname)}`,{
  	    method:'POST',
  	    body:JSON.stringify({
  	        "content":ctnt,
  	        "timestamp":(new Date()).getTime(),
  	        "ignoreconflict":true
  	    }),
  	    header:JSON.stringify({
  	        path:`${encodeURIComponent(urlname)}`
  	    })
  	})
  	    .then(response=>response.json())
  	    .then(Func);
  }
  setInterval(()=>{
    fetch(`https://tikolu.net/edit/.text/${document.getElementById('path').value}`, {method:'GET'})
      .then(respon=>respon.text()).then(a=>document.getElementById('look').innerHTML=a);
  },3000);
  function _edit(){
    EditText(document.getElementById('path').value,document.getElementById("input").value,console.warn);
  }
  function _reload(){
    document.getElementById("input").value=document.getElementById("look").value;
  }
    </script>
  </body>
</html>
